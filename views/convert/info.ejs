<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Victures</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Bootstrap -->
        <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <!-- Fontawesome -->
        <link rel="stylesheet" type="text/css" href="/stylesheets/fontawesome/css/all.min.css">
        <!-- Public -->
        <link rel="stylesheet" type="text/css" href="/stylesheets/style.css">
        <!-- Convert page -->
        <link rel="stylesheet" type="text/css" href="/stylesheets/convert-page.css">
        <!-- Loading -->
        <link rel="stylesheet" type="text/css" href="/stylesheets/loading.css">
        <!-- Local -->
        <style type="text/css">
            .video-thumbnail-form {
                min-width: 350px;
                margin-bottom: 15px;
                position: relative;
                width: 60%;
            }
            .video-thumbnail-form .video-thumbnail {
                width: 100%;
            }

            .video-content {
                background-color: #FEFEFE;
                border-radius: 0.875rem;
                border-top-right-radius: 0;
                position: relative;
            }
            .video-content .form-title {
                background-color: #FEFEFE;
                border-top-left-radius: 0.875rem;
                border-top-right-radius: 0.825rem;
                font-size: 18px;
                margin-bottom: 0;
                line-height: 1;
                position: absolute;
                top: -2.625rem;
                right: 0;
                padding: 0.75rem 1.375rem;
            }
            .video-content-row {
                display: flex;
                padding: 0.875rem 1.125rem;
                border-bottom: 1px dashed #E7EAEC;
            }
            .video-content-subtitle,
            .video-content-detail {
                display: inline-block;
                margin-bottom: 0;
                line-height: 1.4;
            }
            .video-content-detail > p {
                display: inline-block;
                margin-bottom: 0;
            }
            .video-content-subtitle {
                font-weight: 600;
                width: 150px;
            }
            .video-content-detail {
                flex: 1;
                font-weight: 200;
            }
            .video-content-detail[name="url"] > p,
            .video-content-detail[name="author"] > p {
                color: #8000AB;
                cursor: pointer;
                font-weight: 500;
                transition: color 0.4s ease-out;
            }
            .video-content-detail[name="url"] > p:hover,
            .video-content-detail[name="author"] > p:hover {
                color: #F73B0C;
            }
            .video-content-detail[name="description"] > p {
                display: -webkit-box;
                line-height: 1.2em;
                overflow: hidden;
                text-overflow: ellipsis;
                word-wrap:break-word;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
            }

            #loading-info {
                display: flex;
                justify-content: center;
                width: 100%;
            }
        </style>
    </head>
    <body class="basis-background-color">
        <section class="vic-page">
            <article class="vic-page-nav container-xl">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <a class="navbar-brand" href="/video">Victure</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item active">
                                <a class="nav-link" href="/video">List</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/convert">Convert</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Coming soon</a>
                            </li>
                        </ul>
                        <form class="form-search my-2 my-lg-0">
                            <input class="basis-input input-rounded-sm search-input" type="search" placeholder="Search" aria-label="Search" />
                            <span class="search-icon"><i class="fas fa-search"></i></span>
                        </form>
                    </div>
                </nav>
            </article>
            <article class="vic-page-body container-xl d-flex">
                <div class="left-side">
                    <div class="form-step h-65">
                        <div class="form-step-background"></div>
                        <span class="label-step finish"><i class="fa fa-check"></i></span>
                        <span class="label-step active">2</span>
                        <span class="label-step">3</span>
                    </div>
                </div>
                <div class="right-side">
                    <div class="form-convert d-none">
                        <div class="form-info">
                            <div class="video-box">
                                <div class="video-thumbnail-form">
                                    <img class="video-thumbnail" />
                                </div>
                                <div class="video-content shadow-sm">
                                    <h5 class="form-title">Video infomation</h5>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="video-content-row">
                                                <label class="video-content-subtitle">URL</label>
                                                <div class="video-content-detail" name="url"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="video-content-row">
                                                <label class="video-content-subtitle">Title</label>
                                                <div class="video-content-detail" name="title"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-8 pr-0">
                                            <div class="video-content-row">
                                                <label class="video-content-subtitle">Author</label>
                                                <div class="video-content-detail" name="author"></div>
                                            </div>
                                        </div>
                                        <div class="col-4 pl-0">
                                            <div class="video-content-row">
                                                <label class="video-content-subtitle">Upload date</label>
                                                <div class="video-content-detail" name="uploadDate"></div>
                                            </div>
                                        </div>
                                    </div> 
                                    <div class="row">
                                        <div class="col-4 pr-0">
                                            <div class="video-content-row">
                                                <label class="video-content-subtitle">Duration</label>
                                                <div class="video-content-detail" name="duration"></div>
                                            </div>
                                        </div>
                                        <div class="col-4 pl-0 pr-0">
                                            <div class="video-content-row">
                                                <label class="video-content-subtitle">Categories</label>
                                                <div class="video-content-detail" name="categories"></div>
                                            </div>
                                        </div>
                                        <div class="col-4 pl-0">
                                            <div class="video-content-row">
                                                <label class="video-content-subtitle">View count</label>
                                                <div class="video-content-detail" name="viewCount"></div>
                                            </div>
                                        </div>
                                    </div>    
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="video-content-row border-0">
                                                <label class="video-content-subtitle">Description</label>
                                                <div class="video-content-detail" name="description"></div>
                                            </div>
                                        </div>
                                    </div>                              
                                </div>
                            </div>
                        </div>
                        <div class="form-button mt-3">
                            <a class="basis-button rounded-sm px-3" name="prev" href="/convert/step/import">Prev</a>
                            <a class="basis-button rounded-sm px-3" name="next" id="btn-step-next">Next</a>
                        </div>
                    </div>
                    <!-- Loading -->
                    <div id="loading-info">
                        <div class="loading-table-circle">
                            <span class="loading-message">Loading<br/>video info</span>
                            <div class="sk-chase">
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                                <div class="sk-chase-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
        </section>

        <!-- Modal -->
        <div class="modal fade" id="modal-confirm" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-confirm modal-sm" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">해당 영상에 대해 키워드 및 프레임 추출 작업을 진행하시겠습니까?</h5>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="basis-button" data-dismiss="modal">Close</button>
                        <button type="button" class="basis-button" name="next">Next</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
        <!-- Bootstrap -->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" type="text/javascript"></script>
        <!-- Popper -->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" type="text/javascript"></script>
        <!-- Local -->
        <script>
            $(document).ready(() => {
                // Get video info (using session)
                $.ajax({
                    type: "POST",
                    url: "/convert/step/info",
                    success: function(res) {
                        if (res.result) {
                            $('.video-thumbnail').attr('src', res.message.thumbnail);
                            $('.video-content-detail[name="url"]').html(`<p>${printNull(res.message.url)}</p>`);
                            $('.video-content-detail[name="title"]').html(`<p>${printNull(res.message.title)}</p>`);
                            $('.video-content-detail[name="author"]').html(`<p>${printNull(res.message.author)}</p>`);
                            $('.video-content-detail[name="author"] > p').data('url', res.message.authorUrl);
                            $('.video-content-detail[name="uploadDate"]').html(`<p>${printNull(res.message.uploadDate)}</p>`);
                            $('.video-content-detail[name="duration"]').html(`<p>${printNull(res.message.durationString)}</p>`);
                            $('.video-content-detail[name="duration"] > p').data('time', res.message.duration);
                            $('.video-content-detail[name="categories"]').html(`<p>${printNull(res.message.categories)}</p>`);
                            $('.video-content-detail[name="viewCount"]').html(`<p>${printNull(res.message.viewCount).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</p>`);
                            $('.video-content-detail[name="description"]').html(`<p>${printNull(res.message.description)}</p>`);

                            // Relase loading
                            $('#loading-info').addClass('d-none');
                            // Show info
                            $('.form-convert').removeClass('d-none');

                            // URL click event
                            $('.video-content-detail[name="url"] > p').on('click', function() {
                                const url = $(this).text();
                                window.open(url, '_blank')
                            });

                            // Author click event
                            $('.video-content-detail[name="author"] > p').on('click', function() {
                                const url = $(this).data('url');
                                window.open(url, '_blank')
                            });
                        } else {
                            alert("Session expiration");
                            location.href = '/convert/step/import';
                        }
                    }
                });

                // Open confirm modal
                $('#btn-step-next').on('click', function() {
                    $('#modal-confirm').modal('show');
                });
                // Next step (next button in modal)
                $('#modal-confirm button[name="next"]').on('click', function() {
                    const duration = $('.video-content-detail[name="duration"]').data('time');
                    console.log(duration);
                    if (duration > (60 * 20)) {
                        alert("현재 Beta 버전에서는 영상 길이가 최대 20분인 영상만 지원하고 있습니다.");
                    } else {
                        location.href = '/convert/step/process';
                    }
                });

            });

            function printNull(value) {
                if (value === null) {
                    return "-";
                } else {
                    return value;
                }
            }
        </script>
    </body>
</html>